---
layout: post
title: "Git"
subtitle: "Git"
date: 2022-06-05
author: "Lbb"
header-img: "images/post-bg.jpg"
tags: [ tools ]
---

## 1.git资料

---

- [猴子都能懂的GIT入门](http://backlogtool.com/git-guide/cn)
- [Git魔法](http://wiki.jikexueyuan.com/project/git-magic)
- [闯过这 54 关，点亮你的 Git 技能树](http://wiki.jikexueyuan.com/project/git-54-stage-clear)

- Pro Git
  Git是一个自由和开源的分布式版本控制系统，设计用于处理从小到大型项目的速度和效率。
  _[Pro Git](https://git-scm.com/book/en/v1)[中文版](https://git-scm.com/book/zh/v1)_
  _[Pro Git v2 ](https://git-scm.com/book/en/v2)[中文版](https://git-scm.com/book/zh/v2)_

- [Git教程](http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000)
  廖雪峰的Git教程
- [五分钟开始你的Git之旅](http://www.php100.com/html/it/focus/2014/1024/7597.html)
  很多人认为Git太混乱或太复杂而没有把它当做版本控制工具。然而Git正在成长，另外很多很有意思的事情也随之发展起来。这篇文章瞄准了想开始用Git的人群，通常是从Subversion（另一个版本控制工具）转过来的。
- [Linux git命令参数及用法详解](http://www.linuxidc.com/Linux/2012-01/51205.htm)
- [Git 命令参考](http://wiki.jikexueyuan.com/project/git-reference)
- [沉浸式学 Git](http://wiki.jikexueyuan.com/project/git-immersion)
- [Git Community Book 中文版](http://wiki.jikexueyuan.com/project/git-community-book)

## 2.[安装 ](https://git-scm.com/book/zh/v2/%E8%B5%B7%E6%AD%A5-%E5%AE%89%E8%A3%85-Git)

---

- Linux

```shell
# Fedora 上的 yum:
$ sudo yum install git
# Debian 上的 apt-get:
$ sudo apt-get install git
```

Git 官方网站上有在各种 Unix 风格的系统上安装步骤

- Mac
  安装 Xcode Command Line Tools。 Mavericks
  安装 https://git-scm.com/download/mac
- Windows
  安装 https://git-scm.com/download/win

```shell
# 版本查询
git --version
```

## 3.[Git 环境设置](http://www.yiibai.com/git/git_environment.html)

---

初次运行 Git 前的配置`git config`

```shell
git config -e # 当前Git存储库
git config -e --global # 全局设置
git config -e --system # 系统设置
```

- Git的三个配置文件
  - 版本库级别的配置文件（/.git/config）
  - 全局配置文件（用户主目录下）
  - 系统级配置文件（/etc目录下）
    这个命令的作用是打开相应的配置文件，并且进行编辑。其中版本库级别的配置文件的优先级最高，全局配置文件次之，系统级别配置文件最低。Git配置文件采用的是INI文件格式。

```shell
git config <section>.<key> # 读取和更改INI配置文件的内容
git config <section>.<key> <value> # 修改INI配置文件中某个配置的键值
```

- 设置用户名

```shell
git config --global user.name "Your Name"
```

- 设置电子邮件ID

```shell
git config --global user.email "email@example.com"
```

- 查看个人信息

```shell
git config --list
```

- 避免PULLING提交合并

```shell
git config --global branch.autosetuprebase always
```

- 颜色高亮
  下面的命令使颜色突出显示在控制台的Git。

```shell
git config --global color.ui true
git config --global color.status auto
git config --global color.branch auto
```

- 设置默认编辑器

```shell
git config --global core.editor vim
```

- 设置git命令的别名

```shell
git config --global alias.ci commit
git config --global alias.co checkout
```

- 设置默认的合并工具

```shell
git config --global merge.tool vimdiff
```

- 删除git全局配置文件中的用户名

```shell
git config --unset --global user.name
git config --unset --global user.email
```

- 远程仓库设置
  - 生成公共/私有RSA密钥对

```shell
ssh-keygen -t rsa -C "youremail@example.com"
cat ~/.ssh/id_rsa.pub
#github.com验证
ssh -T git@github.com
```

一个是私有的`id_rsa`，另一个是公共`id_rsa.pub`

## 4.仓库

---

- 创建本地版本库

```shell
mkdir gittest
cd learngit
pwd
git init
```

- 添加远程Git仓库

```shell
git remote add [origin] [SSH] # 关联一个远程库，添加远程[SSH]的[origin]分支
git push origin master # 第一次推送master分支的所有内容，不能为空
```

此后，每次本地提交后，只要有必要，就可以使用命令`git push origin master`推送最新修改到master分支；
_例：`git remote add origin git@github.com:lbb4511/Story.git`_
_[github上传时出现error: src refspec master does not match any解决办法](http://www.jianshu.com/p/8d26730386f3)_ **_主要是没有要同步的文件_**

- 克隆远程Git仓库

```shell
git clone <repository> <directory> # 将repository指向的版本库创建一个克隆到directory目录中。目录directory相当于克隆版本库的工作区，文件都会检出，版本库位于工作区下得.git目录中。
git clone --bare <repository> <directory.git>
git clone --mirror <repository> <directory.git>
# 上面的两种克隆版本都不包含工作区，直接就是版本库的内容，这样的版本库称为裸版本库。
git clone SSH # 简写
```

_例:`git clone git@github.com:github/hub.git`_

- 合并两个仓库
  - 远端的服务器上下载数据（git pull）

```shell
git pull # 从远端的服务器上下载数据，从而实现同步更新。要获取的远程版本库的URL地址由remote.<remote>.url提供。
```

- 推送本地库到远程仓库（git push）

```shell
git push <remote> [branch] # 就会将你的 [branch] 分支推送成为 [alias] 远端上的 [branch] 分支
要推送的远程版本号的URL地址由remote.<remote>.pushurl给出，如果没有配置，则使用remote.<remote>.url配置的URL地址。
```

提示：更新被拒绝，因为您当前分支的最新提交落后于其对应的远程分支。
提示：再次推送前，先与远程变更合并（如 'git pull ...'）。详见
提示：'git push --help' 中的 'Note about fast-forwards' 小节。
引起这个问题是远程仓库和本地不同步引起的
解决方案：需要先获取远端更新并与本地合并,再git push具体操作如下:

```shell
git remote add [origin] [SSH] # 添加远程[SSH]的[origin]分支
git fetch origin # 获取远程更新
git merge origin/master # 把更新的内容合并到本地分支
```

_参考[合并两个git仓库](http://blog.csdn.net/gouboft/article/details/8450696)_

## 5.文件

---

- 添加（git add）

```shell
git add # 在提交你修改的文件之前，你需要把它们添加到暂存区。如果该文件是新创建的，你可以执行将该文件添加到暂存区
git add . # Git会递归地将你执行命令时所在的目录中的所有文件添加上去，所以如果你将当前的工作目录作为参数，它就会追踪那儿的所有文件
git add -u # 使用-u参数调用了git add命令，会将本地有改动（包括删除和修改）的已经追踪的文件标记到暂存区中。
git add -A # 使用-A参数会将添加所有改动的已跟踪文件和未跟踪文件。
git add -i # 交互式的方式进行添加。
```

- 删除（git rm）

```shell
rm命令删除的文件只是在本地进行了删除，尚未添加到暂存区，也就是说，直接在工作区删除，对暂存区和版本库没有任何影响。
git rm命令会将删除动作加入暂存区，这是执行提交动作，就从真正意义上执行了文件删除。
```

- 移动或重命名（git mv）

```shell
git mv # 移动文件，git中以git rm和git add两条命令取而代之。
```

- 清除（git clean）
  删除本地多余的目录和文件

````shell
git clean -nd # 显示要删除的内容，但是是预删除
git clean -fd # 强制删除多余的文件和目录
```shell
- 查看文件状态（git status）
```shell
git status # 查看你的代码在缓存与当前工作目录的状态
git status -s # 将结果以简短的形式输出
````

- 查看本次修改内容（git diff）

![](http://upload-images.jianshu.io/upload_images/979228-3c860c858f8d8a5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

```shell
git diff # 显示工作区和暂存区的差异
git diff FileName # 查看文件本次修改内容
git diff HEAD # 显示工作区和HEAD之间的差异
git diff --cached # 显示暂存区和HEAD之间的差异
git diff id1 id2 # 显示两次提交之间的差异
```

- 提交（git commit）

```shell
git commit -m "文件版本内容" # 提交
git commit --amend # 修补式提交。
git commit --a # 对本地所有变更的文件执行提交操作，包括对本地修改的文件和删除的文件，但是不包括未被版本库跟踪的文件。但是这个命令最好不要使用，这样会丢掉Git暂存区带给用户的最大好处：对提交内容进行控制的能力
git commit --allow-empty # 允许执行空白提交
```

- 查看修改履历（git log）
  git log主要用来显示分支中提交更改的记录。当执行git commit以存储一个快照的时候，文件详单、提交消息和提交者的信息、此次提交所基于的快照都会被保存。

```shell
git log --pretty=oneline
git log --oneline # 可以显示更加短小的提交ID.
git log --graph # 显示何时出现了分支和合并等信息.
git log --pretty=raw # 显示提交对象的parent属性.
```

- 回滚（git checkout）

```shell
git checkout branchname # 会改变HEAD头指针，主要用于切换分支
git checkout -b branchname # 用于创建一个新的分支，并且切换到创建的新的分支上
git checkout --filename # 用暂存区中的filename文件来覆盖工作区中的filename文件
git checkout  --filename # 用指定提交中的文件覆盖暂存区和工作区中对应的文件
git checkout -- .或者git checkout . # 用暂存区的所有文件直接覆盖本地文件，取消所有的本地的修改，是一条危险的操作
```

## 6.版本控制

---

- 版本（git rebase）

![](http://upload-images.jianshu.io/upload_images/979228-b029812ee35ea187.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- 版本（git reset）

![](http://upload-images.jianshu.io/upload_images/979228-729ec9a1c2e7d95b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
把当前分支指向另一个位置，并且有选择的变动工作目录和索引

```shell
git reset --hard <commit> # 其中commit是可选项，可以使用引用或者提交ID，如果省略则相当于使用了HEAD的指向作为提交ID，完成的操作包括替换引用的指向，替换暂存区，替换工作区
git reset --soft <commit> # 其中commit是可选项，可以使用引用或者提交ID，如果省略则相当于使用了HEAD的指向作为提交ID。完成的操作主要是更改引用的指向，不改变暂存区和工作区
git reset # 等同于git reset HEAD，用HEAD指向的目录树重置暂存区
git reset -- filename # 将文件filename的改动撤出暂存区，暂存区其他文件不变
git reset HEAD --filename # 等同于git reset -- filename
```

_提交ID可以是前一部分_

- 查看提交记录（git reflog）

```shell
git reflog
```

- 查看Git对象（git cat-file）

```shell
git cat-file -t  # 查看Git对象的类型，主要的git对象包括tree，commit，parent，和blob等。
git cat-file -p  # 查看Git对象的内容
```

- git grep

```shell
git grep # 可以用来搜索工作区中的文件内容
要查找git仓库里某个特定版本里的内容, 我们可以像下面一样在命令行末尾加上标签名(tag reference)，git grep '文字内容' v1.0
```

- 分支（git branch）

```shell
git branch # 显示当前所在的分支
git branch # 创建新的分支branchname
git branch # 基于提交创建新分支，新分支的分支名为
git branch -d # 删除名称为branchname的分支，删除时会检查所有的删除分支是否已经合并到其他分支，否则拒绝删除
git branch -D # 强制删除分支
git branch -m # 重命名分支
```

- git archive

```shell
git archive # 对任意提交对应的目录树建立归档。
git archive -o latest.zip HEAD # 基于最新提交建立归档文件latest.zip
git archive -o partial.tar HEAD src doc # 只将目录src和doc建立到归档文件partial.tar中
git archive --format=tar --prefix=1.0/ v1.0 | gzip > foo-1.0.tar.gz # 基于里程碑v1.0建立归档，并且为归档中的文件添加目录前缀1.0
```

## 7.[git基本命令集合](https://github.com/michaelliao/learngit/blob/master/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E9%9B%86%E5%90%88)

---

| 命令                                                      | 注释                                                                |
| --------------------------------------------------------- | ------------------------------------------------------------------- |
| git init                                                  | # 初始化本地git仓库（创建新仓库）                                   |
| git config --global user.name "xxx"                       | # 配置用户名                                                        |
| git config --global user.email "xxx@xxx.com"              | # 配置邮件                                                          |
| git config --global color.ui true                         | # git status等命令自动着色                                          |
| git config --global color.status auto                     |
| git config --global color.diff auto                       |
| git config --global color.branch auto                     |
| git config --global color.interactive auto                |
| git clone git+ssh://git@192.168.53.168/VT.git             | # clone远程仓库                                                     |
| git status                                                | # 查看当前版本状态（是否修改）                                      |
| git add xyz                                               | # 添加xyz文件至index                                                |
| git add .                                                 | # 增加当前子目录下所有更改过的文件至index                           |
| git commit -m 'xxx'                                       | # 提交                                                              |
| git commit --amend -m 'xxx'                               | # 合并上一次提交（用于反复修改）                                    |
| git commit -am 'xxx'                                      | # 将add和commit合为一步                                             |
| git rm xxx                                                | # 删除index中的文件                                                 |
| git rm -r \*                                              | # 递归删除                                                          |
| git log                                                   | # 显示提交日志                                                      |
| git log -1                                                | # 显示1行日志 -n为n行                                               |
| git log -5                                                |
| git log --stat                                            | # 显示提交日志及相关变动文件                                        |
| git log -p -m                                             |
| git show dfb02e6e4f2f7b573337763e5c0013802e392818         | # 显示某个提交的详细内容                                            |
| git show dfb02                                            | # 可只用commitid的前几位                                            |
| git show HEAD                                             | # 显示HEAD提交日志                                                  |
| git show HEAD^                                            | # 显示HEAD的父（上一个版本）的提交日志 ^^为上两个版本 ^5为上5个版本 |
| git tag                                                   | # 显示已存在的tag                                                   |
| git tag -a v2.0 -m 'xxx'                                  | # 增加v2.0的tag                                                     |
| git show v2.0                                             | # 显示v2.0的日志及详细内容                                          |
| git log v2.0                                              | # 显示v2.0的日志                                                    |
| git diff                                                  | # 显示所有未添加至index的变更                                       |
| git diff --cached                                         | # 显示所有已添加index但还未commit的变更                             |
| git diff HEAD^                                            | # 比较与上一个版本的差异                                            |
| git diff HEAD -- ./lib                                    | # 比较与HEAD版本lib目录的差异                                       |
| git diff origin/master..master                            | # 比较远程分支master上有本地分支master上没有的                      |
| git diff origin/master..master --stat                     | # 只显示差异的文件，不显示具体内容                                  |
| git remote add origin git+ssh://git@192.168.53.168/VT.git | # 增加远程定义（用于push/pull/fetch）                               |
| git branch                                                | # 显示本地分支                                                      |
| git branch --contains 50089                               | # 显示包含提交50089的分支                                           |
| git branch -a                                             | # 显示所有分支                                                      |
| git branch -r                                             | # 显示所有原创分支                                                  |
| git branch --merged                                       | # 显示所有已合并到当前分支的分支                                    |
| git branch --no-merged                                    | # 显示所有未合并到当前分支的分支                                    |
| git branch -m master master_copy                          | # 本地分支改名                                                      |
| git checkout -b master_copy                               | # 从当前分支创建新分支master_copy并检出                             |
| git checkout -b master master_copy                        | # 上面的完整版                                                      |
| git checkout features/performance                         | # 检出已存在的features/performance分支                              |
| git checkout --track hotfixes/BJVEP933                    | # 检出远程分支hotfixes/BJVEP933并创建本地跟踪分支                   |
| git checkout v2.0                                         | # 检出版本v2.0                                                      |
| git checkout -b devel origin/develop                      | # 从远程分支develop创建新本地分支devel并检出                        |
| git checkout -- README                                    | # 检出head版本的README文件（可用于修改错误回退）                    |
| git merge origin/master                                   | # 合并远程master分支至当前分支                                      |
| git cherry-pick ff44785404a8e                             | # 合并提交ff44785404a8e的修改                                       |
| git push origin master                                    | # 将当前分支push到远程master分支                                    |
| git push origin :hotfixes/BJVEP933                        | # 删除远程仓库的hotfixes/BJVEP933分支                               |
| git push --tags                                           | # 把所有tag推送到远程仓库                                           |
| git fetch                                                 | # 获取所有远程分支（不更新本地分支，另需merge）                     |
| git fetch --prune                                         | # 获取所有原创分支并清除服务器上已删掉的分支                        |
| git pull origin master                                    | # 获取远程分支master并merge到当前分支                               |
| git mv README README2                                     | # 重命名文件README为README2                                         |
| git reset --hard HEAD                                     | # 将当前版本重置为HEAD（通常用于merge失败回退）                     |
| git rebase                                                |
| git branch -d hotfixes/BJVEP933                           | # 删除分支hotfixes/BJVEP933（本分支修改已合并到其他分支）           |
| git branch -D hotfixes/BJVEP933                           | # 强制删除分支hotfixes/BJVEP933                                     |
| git ls-files                                              | # 列出git index包含的文件                                           |
| git show-branch                                           | # 图示当前分支历史                                                  |
| git show-branch --all                                     | # 图示所有分支历史                                                  |
| git whatchanged                                           | # 显示提交历史对应的文件修改                                        |
| git revert dfb02e6e4f2f7b573337763e5c0013802e392818       | # 撤销提交dfb02e6e4f2f7b573337763e5c0013802e392818                  |
| git ls-tree HEAD                                          | # 内部命令：显示某个git对象                                         |
| git rev-parse v2.0                                        | # 内部命令：显示某个ref对于的SHA1 HASH                              |
| git reflog                                                | # 显示所有提交，包括孤立节点                                        |
| git show HEAD@{5}                                         |
| git show master@{yesterday}                               | # 显示master分支昨天的状态                                          |
| git log --pretty=format:'%h %s' --graph                   | # 图示提交日志                                                      |
| git show HEAD~3                                           |
| git show -s --pretty=raw 2be7fcb476                       |
| git stash                                                 | # 暂存当前修改，将所有至为HEAD状态                                  |
| git stash list                                            | # 查看所有暂存                                                      |
| git stash show -p stash@{0}                               | # 参考第一次暂存                                                    |
| git stash apply stash@{0}                                 | # 应用第一次暂存                                                    |
| git grep "delete from"                                    | # 文件中搜索文本“delete from”                                       |
| git grep -e '#define' --and -e SORT_DIRENT                |
| git gc                                                    |
| git fsck                                                  |
